{% extends 'base_dashboard.html' %}
{% load static %}

{% block navs %}

<div class="container">
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-success">{{ message }}</div>
      {% endfor %}
    {% endif %}
</div>

<div class="col-lg-12 col-xl-12">
    <div class="m-3">
        <h5>
            Serviços
            <button id="create-servico" class="btn btn-save btn-sm float-end" type="button" name="button">+ Adicionar</button>
        </h5>
    </div>
    <div class="card info-card customers-card">
      <div class="p-3">
            <div class="col">              
                <table id="servico-table" class="table">
                    <tr>
                        <th>Serviços</th>
                        <th>Tempo</th>
                        <th>Preço R$</th>
                        <th></th>
                    </tr>
                    {% for servicos in  object_list %}
                    <tr>
                        <td>{{ servicos.servicos }}</td>
                        <td>{{ servicos.tempo }}</td>
                        <td>{{ servicos.preco }}</td>
                        <td>
                            <div class="dropdown">
                                <a  href="#" data-bs-toggle="dropdown">
                                    <i class="bi bi-three-dots"></i>  
                                </a>
                                <div class="dropdown-menu dropdown-menu-end ">
                                    <button id="update-servico" type="button" class="dropdown-item d-flex align-items-center"
                                             data-form-url="{% url 'editar_servico' servicos.pk %}">
                                        <i class="bi bi-pencil-square"></i>
                                        <span>Editar</span>
                                    </button>
                                    <hr class="dropdown-divider">
                                    <button id="delete-servico" type="button" class="dropdown-item d-flex align-items-center" 
                                            data-form-url="{% url 'excluir_servico' servicos.pk %}">
                                        <i class="bi bi-trash"></i>
                                        <span>Excluir</span>
                                    </button>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3">Nuhum campo cadastrado</td>
                    </tr>
                    {% endfor %}
                </table> 
            </div> 
        </div>        
    </div>
</div>

<div class="modal fade" id="create-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">

      </div>
    </div>
</div>

<div class="modal fade" id="update-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">

      </div>
    </div>
</div>

<div class="modal fade" id="delete-modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
            delete modal
      </div>
    </div>
</div>


{% endblock %}

{% block script %}

<script src="{% static 'js/jquery.bootstrap.modal.forms.js' %}"></script>

<script>
        
    $(function() {

        function createModalForm(){
                $("#create-servico").modalForm({
                formURL: "{% url 'criar_servico' %}",
                modalID: "#create-modal",

            });
        };
        createModalForm();

        var asyncSuccessMessage = [
          "<div ",
          "style='position:fixed;top:0;z-index:10000;width:100%;border-radius:0;' ",
          "class='alert alert-icon alert-success alert-dismissible fade show mb-0' role='alert'>",
          "Success: Book was updated.",
          "<button type='button' class='close' data-dismiss='alert' aria-label='Close'>",
          "<span aria-hidden='true'>&times;</span>",
          "</button>",
          "</div>",
          "<script>",
          "$('.alert').fadeTo(2000, 500).slideUp(500, function () {$('.alert').slideUp(500).remove();});",
          "<\/script>"
        ].join();
        
        function updateModalForm(){
            $("#update-servico").each(function() {
                $(this).modalForm({
                    formURL:$(this).data("form-url"),
                    asyncUpdate: true,
                    modalID:"#update-modal",
                    errorClass: ".is-invalid",
                    asyncSettings: {
                        closeOnSubmit: false,
                        dataUrl: "{% url 'servicos' %}",
                        successMessage: 'ssss',
                        dataElementId: "#servico-table",
                        dataKey: "table",
                        addModalFormFunction: updateModalForm
                    }
                });
            });
        }
        updateModalForm();

        
        $("#delete-servico").each(function() {
            $(this).modalForm({
                formURL:$(this).data("form-url"),
                isDeleteForm:true,
                modalID:"#delete-modal"
            });

        });

        function restartModalForms(){
            createModalForm();
            updateModalForm();
        }

    });
</script>
    
{% endblock%}
